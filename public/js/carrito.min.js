var paymentDataip,aPagarBs=0,aPagarUsd=0,checkDeliveryType=0;document.getElementById("div_fecha")&&(div_fecha.innerHTML="Cargando...",get("horasDisponiblesEntrega")),document.getElementById("div_direccion_entrega")&&(div_direccion_entrega.innerHTML="Cargando...",get("getAdreess")),document.getElementById("div_resumen_compra")&&(div_resumen_compra.innerHTML="<div class='loaderb'><div>",get("web_no_login")),document.getElementById("factura")&&(factura.innerHTML="<div class='loaderb'><div>",get("consultarOrden","&id="+orders_id));var id_orders="";"undefined"!=typeof orders_id&&(id_orders=orders_id);var activar_envio=!1,direccionOrden=0,horaEntregaOrden="NULL",limite_max_pagos_alcanzado=!1,ordenPagada=!1;function refrescar(){location.reload()}function procesarPago(){var t=input_amount.value,e=input_coins_id.value,a=input_rate.value,o=input_bank_datas_id.value,r="",n="";if(2==e){if(t>aPagarBs)throw Swal.fire("Bio en Línea","El monto a pagar en Bolivares debe ser exacto","warning"),new Error("El monto a pagar debe ser exacto");r=(t=parseFloat(formato_moneda(t))*a).toFixed(2)}if(1==e&&(t*=a),3==o){datosBancarios.innerHTML='\n\t\t<div class="row"><div class="col-md-12 text-center"><br>Luego de procesar su pago exitoso en TDC se refrescará esta ventana</div></div>\n\t\t',url_popup=url_base+"/mega/PreRegistro.php?nro_orden="+id_orders+"&total="+r,ventana=window.open(url_popup,"myWindow","width=400,height=450");var d=window.setInterval(function(){!1!==ventana.closed&&(window.clearInterval(d),refrescar())},200);return!1}if(6==o){datosBancarios.innerHTML='\n\t\t<div class="row"><div class="col-md-12 text-center"><br>Luego de procesar su pago exitoso en TDD se refrescará esta ventana</div></div>\n\t\t',url_popup=url_base+"/mercantil/index.php?evento=inicio&nroFactura="+id_orders+"&amount="+r,ventana=window.open(url_popup,"myWindow","width=400,height=550");d=window.setInterval(function(){!1!==ventana.closed&&(window.clearInterval(d),refrescar())},200);return!1}return n=document.getElementById("input_ref")?input_ref.value:"",div_btn_guardar_pago.innerHTML="<div class='loaderb'><div>",get("guardarPago","&amount="+t+"&ref="+n+"&coins_id="+e+"&orders_id="+id_orders+"&bank_datas_id="+o),!1}function elegidoMetodo(t,e){bancosDelMetodo.innerHTML="<div class='loaderb'><div>",get("listarBancosdelMetododePago","&payment_methods_id="+t),location.href="#utlimo_metodo_pago"}function elegidoBanco(t,e,a,o,r,n,d){var i='<div class="col-md-6">\n\t<label>Referencia Bancaria:</label>\n\t<input id="input_ref" name="ref" class="form-control" type="text">\n\t\t</div>',s="",c="Pagar",l=0,v="<button onclick='return procesarPago();' class='btn btn-success'>"+c+"</button>";if(3!=t&&2!=t&&6!=t&&7!=t&&10!=t&&12!=t&&15!=t&&13!=t||(i="",s='<div class="col-md-3"></div>'),3==t&&(c="Procesar TDC"),6==t&&(c="Procesar TDD"),v="<button onclick='return procesarPago();' class='btn btn-success'>"+c+"</button>",15==t){var m=user_data.split(","),u=m[0].split("-")[1],p=m[1].split(" ")[0],g=m[1].split(" ")[1],_=orders_id,f=m[2];l=up(aPagarUsd,2),url_popup=url_base+"/international-payment-button/"+p+"/"+g+"/"+u+"/"+_+"/"+l+"/"+f,v="<iframe src='"+url_popup+"' width='250' height='250' frameborder='0'></iframe>"}if(1==n){var b="^\\$?(([1-9](\\d*|\\d{0,2}(,\\d{3})*))|0)(\\.\\d{1,2})?$",y="Use punto (.) para decimales";l=up(aPagarUsd,2)}else{b="^\\$?(([1-9](\\d*|\\d{0,2}(.\\d{3})*))|0)(,\\d{1,2})?$",y="Use coma (,) para decimales";l=aPagarBs}var h="Ingrese el monto en "+r+":";"bio wallet"==e&&(h="Introduzca el monto que desea usar de su saldo disponible en bio wallet"),datosBancarios.innerHTML="\n\t<div class='row text-center h5'>\n\t<div class=\"col-md-12\">\n\tBanco: "+e+"\n\t</div>\n</div>\n\t<div class='row text-center h5'>\n\t\t<div class=\"col-md-12\">\nTitular: "+a+"\n\t\t</div>\n \n\t</div>\n\t<div class='row text-center h5'>\n\t\t<div class=\"col-md-12\">\n\t\tDatos: "+o+"\n\t\t</div>\n\t</div>\n\t<div class='row text-center h5'>\n\t\t<div class=\"col-md-12\">\n\t\tMoneda: "+r+'\n\t\t</div>\n\t</div>\n<form onsubmit="return false;" autocomplete="off">\n\t<div class=\'row\'>\n\t\t'+s+'\n\t\t<div class="col-md-6">\n\t\t\t<label>'+h+':</label>\n\t\t\t<input id="input_amount" title="'+y+'" pattern="'+b+'" name="amount" value="'+l.toFixed(2)+'" required class="form-control" type="text">\n\t\t\t<input id="input_coins_id" type="hidden" name="coins_id" value="'+n+'">\n\t\t\t<input id="input_rate" type="hidden" name="rate" value="'+d+'">\n\t\t\t<input id="input_bank_datas_id" type="hidden" name="bank_datas_id" value="'+t+'">\n\t\t</div>\n\t\t'+i+'\n\t</div>\n\t<div class=\'row text-center\'>\n\t\t<div class="col-md-12">\n\t\t<br>\n\t\t\t<div id="div_btn_guardar_pago">\n\t\t\t\t'+v+"\n\t\t\t </div>\n\t\t</div>\n\t</div>\n   </form> \n\t\n\t"}function procesar(t,e){switch(e){case"guardarPago":1==(t=JSON.parse(t)).success?(Swal.fire("Bio en casa","Su pago ha sido procesado","success"),location.reload()):(Swal.fire("Bio en casa",t.msj_general,"danger"),div_btn_guardar_pago.innerHTML='<button class="btn btn-success">Pagar</button>');break;case"listarBancosdelMetododePago":if(1==(t=JSON.parse(t)).success){var a="<hr>",o=t.data;for(var[n,d]of Object.entries(o)){var i="";i=null!=d.description?d.description.replace(/(\r\n|\n|\r)/gm,""):"megasoft",a+='<div class="row"><div class="col-md-1 col-1"></div><div class="col-md-1 col-1"><input name="b"  class="form-controld" type="radio" onclick="elegidoBanco(\''+d.id+"','"+d.b_name+"','"+d.titular+"','"+i+"','"+d.c_name+"','"+d.coins_id+"','"+d.rate+'\')" value="'+d.id+'"></div><div class="col-md-10 col-10">'+d.b_name+" ("+d.c_name+")</div></div><hr>"}bancosDelMetodo.innerHTML=a+"<div id='datosBancarios'></div>"}break;case"listarMetodosDePago":if(1==limite_max_pagos_alcanzado)metodosPago.innerHTML="<div class='text-danger center'><br>Disculpe, ya agoto sus 2 pagos máximos, deber ir a nuestra tienda biomercados más cercana para reportar su situación.</div>";else if(1==(t=JSON.parse(t)).success){a="<hr>",o=t.data;var s="";for(var[n,d]of Object.entries(o))0==n&&(s="id='utlimo_metodo_pago'"),a+='<div class="row"><div class="col-md-1 col-1"><input name="a" '+s+'  class="form-controld" type="radio" onclick="elegidoMetodo(\''+d.id+"','"+d.name+'\')" value="'+d.id+'"></div><div class="col-md-11 col-11">'+d.name+"</div></div><hr>";metodosPago.innerHTML=a+"<div id='bancosDelMetodo'></div>"}break;case"totalPagar":if(1==(t=JSON.parse(t)).success){ra=t.data[0];for(var c=JSON.parse(ra.rate_json),l=0;l<c.length;l++){var v=+c[l].id;if(_rateb=parseFloat(c[l].rate),1==v)break}var m=parseFloat(ra.total_pay)/_rateb;m=up(m,2);var u=0;if("0"!=ra.cant_pagos){var p=JSON.parse(ra.pago_json);for(l=0;l<p.length;l++)u+=parseFloat(p[l].amount);u.toFixed(2)>=parseFloat(ra.total_pay)&&(ordenPagada=!0,div_image_top.innerHTML='<img style="margin:0 auto" src="img/topPagado.png">',div_completo_metodo_pago.innerHTML='<div class="row mt-4"><div class="col-md-12 center h3 text-center" style="color:#67BE5A"><br><br><br><br>Desde bio mercados agradecemos su preferencia, nuestra prioridad es ofrecer el mejor servicio siempre. ¡Inspirados en servir!!</div></div>')}var g=u/_rateb,_=parseFloat((parseFloat(ra.total_pay)-u).toFixed(2)),f=_/_rateb;f=up(f,2),aPagarUsd=f;var b="",y="Debes Pagar";if((aPagarBs=_)<=0&&(b="style='display:none'",y="Has pagado"),_>0)var h="text-danger";else h="";cuadroPagado.innerHTML='\n\t\t\t<div class="row">\n\t\t\t<div class="col-md-6 text-left"><b>'+y+'</b></div><div class="col-md-6 text-right"><b>'+formatB(ra.total_pay)+" / "+formatD(m)+'</b></div>\n\t\t</div>\n\t\t<div class="row" '+b+'>\n\t\t\t<div class="col-md-6 text-left"><b>Has pagado</b></div><div class="col-md-6 text-right"><b>'+formatB(u)+" / "+formatD(g)+'</b></div>\n\t\t</div>\n\t\t<div class="row '+h+'" '+b+'>\n\t\t\t<div class="col-md-6 text-left "><b>Saldo restante</b></div><div class="col-md-6 text-right"><b>'+formatB(_)+" / "+formatD(f)+"</b></div>\n\t\t</div>   \n\t\t\t"}break;case"consultarOrden":if(1==(t=JSON.parse(t)).success){r=t.data[0];var w=parseFloat(r.total_transport)+parseFloat(r.sub_total),B=JSON.parse(r.rate_json);for(l=0;l<B.length;l++){var x=+B[l].id;if(_rate=parseFloat(B[l].rate),1==x)break}var P=up(parseFloat(Math.ceil(r.total_pay))/_rate,2);_totalProductoB=new Object,_totalProductoD=new Object,_totalProductoBConFormato=new Object,_totalProductoDConFormato=new Object,res=JSON.parse(r.productos);var I="";for(l=0;l<res.length;l++){var L=res[l].name,M=res[l].cant,O=res[l].price;_totalProductoB[l]=parseFloat(O)*parseFloat(M),_totalProductoBConFormato[l]=formatB(_totalProductoB[l]),_totalProductoB[l],_totalProductoD[l]=_totalProductoB[l]/_rate,_totalProductoDConFormato[l]=formatD(_totalProductoD[l]),_totalProductoD[l],I+='\n\t\t\t\t\t<div class="row celda" style="font-size:10px; border-bottom:1px solid #ddd">\n\t\t\t\t\t\t<div class="col-md-5 text-left">'+L+'</div>\n\t\t\t\t\t\t<div class="col-md-3 text-right">'+formatB(O)+'</div>\n\t\t\t\t\t\t<div class="col-md-1 text-right">'+M+'</div>\n\t\t\t\t\t\t<div class="col-md-3 text-right">'+formatB(_totalProductoB[l])+"</div>\n\t\t\t\t\t</div>"}factura.innerHTML=`\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-md-12 text-center h4" style="color:#67BE5A">Detalles de la orden #${id_orders}</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div id="cuadroPagado"></div>\n\t\t   \n\t\t\t\t<hr>                      \n\t\t\t\t<div class="row" style="font-size:12px">\n\t\t\t\t\t<div class="col-md-5 text-left"><b>Producto</b></div>\n\t\t\t\t\t<div class="col-md-3 text-right"><b>Precio Und.</b></div>\n\t\t\t\t\t<div class="col-md-1 text-right"><b>Cant.</b></div>\n\t\t\t\t\t<div class="col-md-3 text-right"><b>Total</b></div>\n\t\t\t\t</div>\n\t\t\t\t<div >`+I+'</div>\n\t\t\t   <div class="row">\n\t\t\t\t\t<div class="col-md-6 text-left">Productos</div><div class="col-md-6 text-right">'+formatB(r.sub_total)+'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="row">    \n\t\t\t\t\t<div class="col-md-6 text-left">Envío</div><div class="col-md-6 text-right">'+formatB(r.total_transport)+'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-md-6 text-left">Sub total</div><div class="col-md-6 text-right">'+formatB(w)+'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-md-6 text-left">Exento</div><div class="col-md-6 text-right">'+formatB(r.exento)+'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-md-6 text-left">BI.</div><div class="col-md-6 text-right">'+formatB(r.bi)+'</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-md-6 text-left">Impuestos</div><div class="col-md-6 text-right">'+formatB(r.total_tax)+'</div>\n\t\t\t\t</div>\n\t\t\t\t<hr>\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-md-6 text-left"><b>TOTAL A PAGAR</b></div><div class="col-md-6 text-right"><b>'+formatB(r.total_pay)+" / "+formatD(P)+"</b></div>\n\t\t\t   </div>\n\n\t\t\t\t",document.getElementById("cuadroPagado")&&(cuadroPagado.innerHTML="<div class='loaderb'><div>",get("totalPagar","&orders_id="+id_orders)),document.getElementById("metodosPago")&&(cuadroPagado.innerHTML="<div class='loaderb'><div>",get("listarMetodosDePago"))}else Swal.fire("Bio en Línea",t.msj_general);break;case"crearOrden":if(1==(t=JSON.parse(t)).success){var D=t.data[0].id;window.location="/profile?orders_id="+D,vaciarCarrito()}else Swal.fire("Bio en Línea",t.msj_general);break;case"web_no_login":if(1==(t=JSON.parse(JXG.decompress(t))).success){let e=t.data;for(var[n,d]of Object.entries(e))setLocal(n,d);actualizarResumenOrden()}break;case"web_no_logina":t=JSON.parse(JXG.decompress(t));break;case"horasDisponiblesEntrega":var E="";if(!(t=JSON.parse(t)).success)return!1;o=t.data;for(var[n,d]of Object.entries(o))E+="<option value="+d.time+">"+d.name+"</option>";div_fecha.innerHTML="<select class='form-control' id='fecha_hora_entrega' name='timepick' v-model='datetime' name='fecha_hora_entrega'>"+E+"</select>";break;case"getAdreess":E="";if(!(t=JSON.parse(t)).success)return 6!=storeId?div_direccion_entrega.innerHTML="<select class='form-control' id='direccion_selected' name='direccion' v-model='selectedDirection'><option value='-1'>Pick - Up</option></select><br><a href='/profile?tab=my-address'>Agregar nueva dirección</a>":div_direccion_entrega.innerHTML="<select class='form-control' id='direccion_selected' name='direccion' v-model='selectedDirection'><option value='0'>Sin Direcciones</option></select><br><a href='/profile?tab=my-address'>Agregar nueva dirección</a>",!1;o=t.data;for(var[n,d]of(6!=storeId&&(E+="<option value='-1' id='one_value'>Pick - Up</option>"),Object.entries(o)))E+="<option value="+d.id+">"+d.address+" - "+d.st_name+", "+d.re_name+", "+d.urb+", "+d.sector+",  #"+d.nro_home+"</option>";div_direccion_entrega.innerHTML="<select onchange='activarEnvio(this)' class='form-control' id='direccion_selected' name='direccion' v-model='selectedDirection' >"+E+"</select><br><a href='/profile?tab=my-address'>Agregar nueva dirección</a>"}}function procesarOrden(){document.getElementById("direccion_selected")&&"0"!=document.getElementById("direccion_selected").value?2==checkDeliveryType&&aPagarUsd<3?Swal.fire("Bio en Línea","Para este tipo de delivery el monto debe ser al menos de 3$","error"):Swal.fire({title:"Bio en Línea",text:"A partir de este momento no podra modificar su carrito, esta seguro de continuar?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"}).then(t=>{if(t.value){var e=getLocal("cartNew"),a=new Object,o=new Object;for(var[r,n]of(0==direccionOrden||"0"==direccionOrden?a.direccion="NULL":(a.direccion=direccionOrden,a.delivery_type=document.getElementById("dvy_type").value),a.hora_entrega=fecha_hora_entrega.value,Object.entries(e))){var d=n.product.id,i=n.cant;o[d]=i}a.productos=o,get("crearOrden","&json="+JSON.stringify(a))}}):Swal.fire("Bio en Línea","No hay direcciones registradas","error")}function activarEnvio(t){var e=document.getElementById("direccion_selected").value;0==parseInt(t.value)?(activar_envio=!1,direccionOrden=null):1==parseInt(t.value)?(direccionOrden=e,activar_envio=!0):2==parseInt(t.value)&&(activar_envio=!1,direccionOrden=e),actualizarResumenOrden()}function getOrder(t){window.location="/profile?orders_id="+t.value}function actualizarResumenOrden(){var t="",e=getLocal("productosb"),a=getLocal("envio").data[0],o="",r=0,n=0,d=0,i=0,s=0,c=getLocal("cartNew");if(c){for(var[l,v]of Object.entries(c)){var m=e[v.product.id];if(null!=m){var u=v.cant,p=m.peso,g=m.total_precio*u,_=m.total_precio_dolar*u,f=m.name;r+=g,n+=_,d+=p,o+='<div class="row" style="margin-bottom:5px; border-bottom:1px solid #ddd "><div class="col-md-1" style="margin:0"><img width="30px" src="storage/'+m.image+'"></div><div class="col-md-5" style="font-size:13px">'+f+' <span style="color:red"> X '+u+'</span></div><div class="col-md-5" style="text-align:right">'+formatB(g)+"<br>"+formatD(up(_,2))+"</div></div>"}}for(var b=a?a.peso_max:0,y=a?a.precio_b:0,h=a?a.precio_d:0,w=b,B=1;d>=w;)B++,w+=b+w;0==activar_envio&&(B=0),i=y*B,s=h*B,totalPagarB=i+r,totalPagarD=s+n,aPagarUsd=totalPagarD,t='<div class="detalleOrdenProducts">'+o+'</div><br><div class="row"><div class="col-md-4">Sub total:</div><div class="col-md-8" style="text-align:right">'+formatB(r)+" / "+formatD(up(n,2))+'</div></div><div class="row"><div class="col-md-4">Envío:</div><div class="col-md-8" style="text-align:right">'+formatB(i)+" / "+formatD(up(s,2))+'</div></div><div class="row"><div class="col-md-4" style="font-size:17px">TOTAL:</div><div class="col-md-8" style="font-size:17px; text-align:right">'+formatB(totalPagarB)+" / "+formatD(up(totalPagarD,2))+'</div></div><div class="row"><div class="col-md-12" style="color:red; text-align:right">(impuestos incluidos)</div></div><br>'}document.getElementById("div_resumen_compra")&&(div_resumen_compra.innerHTML=t),document.getElementById("div_resumen_compra2")&&(div_resumen_compra2.innerHTML=t)}function actualizarStore(){get("web_no_login")}function get(t,e=""){var a=window.location.host,o=window.location.protocol,r=new XMLHttpRequest;let n=new Map;n.success=!1,n.msj_general="Intente mas tarde",r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200==r.status||409==r.status?procesar(r.responseText,t):procesar(n,t))},r.open("GET",o+"//"+a+"/api_rapida.php?id_tienda="+storeId+"&evento="+t+e,!0),r.send()}function post(t,e){e.append("evento",t);var a=window.location.host,o=window.location.protocol,r=new XMLHttpRequest;let n=new Map;n.success=!1,n.msj_general="Intente mas tarde",r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200==r.status||409==r.status?procesar(r.responseText,t):procesar(n,t))},r.open("POST",o+"//"+a+"/api_rapida.php",!0),r.send(e)}function setLocal(t,e){localStorage.setItem(t,JSON.stringify(e))}function getLocal(t){return JSON.parse(localStorage.getItem(t))}function delLocal(t){localStorage.removeItem(t)}function formatB(t){return formatMoney(t,2,",",".")+" Bs"}function formatD(t){return"$"+formatMoney(t,2,".",",")}function formatMoney(t,e=2,a=".",o=","){try{e=Math.abs(e),e=isNaN(e)?2:e;const r=t<0?"-":"";let n=parseInt(t=Math.abs(Number(t)||0).toFixed(e)).toString(),d=n.length>3?n.length%3:0;return r+(d?n.substr(0,d)+o:"")+n.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+o)+(e?a+Math.abs(t-n).toFixed(e).slice(2):"")}catch(t){}}function vaciarCarrito(){localStorage.clear(),localStorage.setItem("ModalPrincipal","visto")}function formato_moneda(t){var e,a="",o=t.trim(),r=(e=(o=(o=(o=o.split(" ").join("")).split(".").join(" ")).split(",").join(" ")).split(" ")).length;return r>1?(e[r-1]="."+e[r-1],e.forEach(t=>a+=t)):a=o,a}function getPaymentData(t){(paymentDataip=t)||(Swal.fire("Bio en Línea","Su pago no se ha podido procesar, intente nuevamente!!","error"),document.getElementById("div_btn_guardar_pago").innerHTML="<div class='loaderb'><div>",location.reload())}function successPayment(){document.getElementById("div_btn_guardar_pago").innerHTML="<div class='loaderb'><div>",location.reload()}function deli_type(t){var e=document.getElementById("select_address");checkDeliveryType=t.value,parseInt(t.value)>0?(e.style.display="block",document.getElementById("one_value")?(document.getElementById("one_value").style.display="none",document.getElementById("direccion_selected").selectedIndex=1):document.getElementById("direccion_selected").selectedIndex=0):(e.style.display="none",document.getElementById("one_value")&&(document.getElementById("one_value").style.display="block"),document.getElementById("direccion_selected").selectedIndex=0),2==parseInt(t.value)||1==parseInt(t.value)?document.getElementById("div_contenedor_fecha").style.display="none":document.getElementById("div_contenedor_fecha").style.display="block",document.getElementById("dvy_type").value=t.value,activarEnvio(t)}function up(t,e){return Math.ceil(t*Math.pow(10,e))/Math.pow(10,e)}document.getElementById("pickout-contenedor")&&6==storeId&&(document.getElementById("pickout-contenedor").style.display="none",document.getElementById("div_contenedor_fecha").style.display="none",document.getElementById("select_address").style.display="block",document.getElementById("auto-checked").checked=!0);